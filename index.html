<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>å‘†å‘†ç¸å¤©æ°£</title>
    <link rel="icon" type="image/png" href="./slowpoke-icon.png" />
    <link rel="apple-touch-icon" href="./slowpoke-icon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./slowpoke-icon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        /* å‘†å‘†ç¸æ£²æ¯åœ°é…è‰²ï¼šç²‰å«©ã€å¤§åœ°ã€æœ¨é ­ã€æ°´è— (å·²èª¿æ•´ç‚ºæ›´åƒæœ¨é ­çš„è‰²ç³») */
        --sp-pink-light: #ffddeb; /* ç²‰ç´… (å‘†å‘†ç¸é«”è‰²) */
        --sp-pink: #f8b4d8; /* ç¨æ·±ç²‰ç´… */
        --sp-green-grass: #95c18c; /* è‰åœ°ç¶  (èƒŒæ™¯) */
        /* â¬‡ï¸ èª¿æ•´ï¼šæœ¨æ¿åšåº¦/æ·±è‰²é‚Šæ¡† (æ›´æ¿ƒéƒï¼Œå¢å¼·å°æ¯”) */
        --sp-brown-wood: #6b4f40;
        /* â¬‡ï¸ èª¿æ•´ï¼šæœ¨æ¿è¡¨é¢åº•è‰² (æ›´æº«æš–å¯æ„›) */
        --sp-brown-light: #d2b48c;
        --sp-cream-board: #f4f2f0; /* æœ¨æ¿åº•è‰² (ç¨å¾®åç°ç™½) */
        --sp-blue-water: #b7eeff; /* æ°´è—è‰² */
        --sp-dark: #634f40; /* æ·±è‰²æ–‡å­— */
        --sp-card-border: #d0c2b2;
        --sp-wood-highlight: #ffecc7; /* æ–°å¢ä¸€å€‹ç«‹é«”é«˜å…‰è‰² (é‡˜å­ä¸»é«”è‰²) */
        /* ã€æ–°å¢ã€‘æ·±ä¸€é»çš„æ°´è—è‰²ï¼Œç”¨æ–¼é å ±æ–‡å­— */
        --sp-blue-dark: #407b94;
      }

      /* é€šç”¨æ¨£å¼ä¿æŒä¸è®Š */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      /* === 1. æ•´é«”è¦–è¦ºï¼šå‘†å‘†ç¸æ£²æ¯åœ° === */
      body {
        font-family: "Zen Maru Gothic", sans-serif;
        background-color: var(--sp-green-grass); /* ç¶ è‰²è‰åœ° */

        /* === ã€èƒŒæ™¯åœ–ç‰‡ä¸Šå‚³å€ã€‘ === */
        /* å¦‚æœæ‚¨è¦ä½¿ç”¨åœ–ç‰‡ï¼Œè«‹è§£é™¤è¨»é‡‹ä¸‹æ–¹å…©è¡Œï¼Œä¸¦æ›¿æ› URL */
        background-image: url(image/bg.png);
        background-size: cover;
        background-repeat: no-repeat;

        min-height: 100vh;
        color: var(--sp-dark);
        overflow-x: hidden;
        padding-bottom: 20px;
      }

      /* é ‚éƒ¨ç‹€æ…‹åˆ— */
      .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: rgba(255, 255, 255, 0.5); /* æ·ºè‰²åŠé€æ˜ */
        backdrop-filter: blur(5px);
        position: sticky;
        top: 0;
        z-index: 100;
        border-bottom-left-radius: 15px;
        border-bottom-right-radius: 15px;
      }

      .location-pill {
        /* æœ¨é ­æ‹›ç‰Œæ¨™ç±¤ */
        background: var(--sp-brown-wood);
        color: var(--sp-cream-board);
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: 900;
        font-size: 1.1rem;
        transform: rotate(-3deg);
        border: 2px solid white;
        box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.15);
      }

      .update-pill {
        font-size: 0.8rem;
        color: var(--sp-dark);
        background: var(--sp-pink-light);
        padding: 4px 10px;
        border-radius: 12px;
        font-weight: bold;
      }

      .container {
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
      }

      /* === 2. æ ¸å¿ƒï¼šæ›´åƒæœ¨é ­çœ‹æ¿å¡ç‰‡ (å·²å¢å¼·ç«‹é«”æ„Ÿèˆ‡å¯æ„›åº¦) === */
      .hero-card {
        background-color: var(--sp-brown-light); /* æ·ºæœ¨é ­åº•è‰² */
        border-radius: 25px; /* ç•¥åŠ å¤§åœ“è§’ï¼Œæ›´å¯æ„› */
        padding: 30px 25px;
        text-align: center;
        position: relative;
        margin-bottom: 40px;
        /* å¢æ·»ç”Ÿå‹•æ„Ÿï¼šå¾®å¾®å‚¾æ–œ */
        transform: rotate(-1.5deg);

        /* é—œéµç«‹é«”æ„Ÿèª¿æ•´ */
        box-shadow: inset 0 10px 10px rgba(255, 255, 255, 0.4),
          /* é ‚éƒ¨é«˜å…‰ */ 0 15px 0 0 var(--sp-brown-wood),
          /* åº•éƒ¨åšåº¦ */ 0 20px 30px rgba(0, 0, 0, 0.4); /* æµ®å‹•é™°å½± (åŠ å¤§) */

        /* é‚Šæ¡†ï¼šä½¿ç”¨è¼ƒåšçš„é›™å±¤é‚Šæ¡† */
        border: 8px solid var(--sp-brown-wood);

        /* å‚ç›´çš„æœ¨ç´‹ç´‹ç† (Wood Grain) */
        background-image:
            /* æ·±è‰²ç·šæ¢ç´‹ç† (æ›´ç¨€ç–) */ repeating-linear-gradient(
            0deg,
            var(--sp-brown-light),
            var(--sp-brown-light) 6px,
            rgba(107, 79, 64, 0.15) 6px,
            rgba(107, 79, 64, 0.15) 7px
          ),
          /* æ·ºè‰²ç·šæ¢ç´‹ç† (é«˜å…‰) */
            repeating-linear-gradient(
              0deg,
              transparent,
              transparent 20px,
              rgba(255, 255, 255, 0.3) 20px,
              rgba(255, 255, 255, 0.3) 21px
            );
        background-size: 100% 100%;
      }

      /* å¢åŠ å››å€‹è§’é‡˜å­/èºçµ² (ç«‹é«”å¯æ„›çš„è£é£¾) - é€™è£¡åªå¯¦ä½œäº†é ‚éƒ¨å…©è§’ */
      .hero-card::before,
      .hero-card::after {
        content: "";
        position: absolute;
        width: 15px;
        height: 15px;
        background: var(--sp-wood-highlight); /* æ·ºè‰²ä½œç‚ºé‡˜å­ä¸»é«” */
        border: 3px solid var(--sp-brown-wood);
        border-radius: 50%;
        z-index: 10;
        box-shadow: 0 2px 0 var(--sp-brown-wood); /* ç«‹é«”é™°å½± */
      }

      /* å·¦ä¸Šèˆ‡å³ä¸Š */
      .hero-card::before {
        top: -8px;
        left: -8px;
      }
      .hero-card::after {
        top: -8px;
        right: -8px;
      }

      /* ã€ä¿®æ­£é» 1ã€‘å°è©±æ°£æ³¡æ¨£å¼ */
      .hero-period {
        position: absolute;
        top: -10px;
        left: 50%;
        /* 1-1. å¥—ç”¨èˆ‡æœ¨æ¿ç›¸åŒçš„å‚¾æ–œè§’åº¦ */
        transform: translateX(-50%) rotate(-1.5deg);

        background: #6b4f40; /* ç²‰ç´…è‰²æ°£æ³¡ */
        color: white;
        padding: 8px 25px;
        /* 1-2. ç§»é™¤å°–è§’ï¼Œæ”¹ç‚ºå››å€‹åœ“è§’ */
        border-radius: 30px;

        font-weight: 900;
        /* 1-3. é‚Šæ¡†æ”¹ç‚ºå’–å•¡è‰² */
        border: 4px solid var(--sp-brown-wood);
        box-shadow: 2px 2px 0 var(--sp-brown-wood);
        font-size: 1.1rem;
        outline: 8px solid #6b4f40; /* å¢åŠ ç™½è‰²æé‚Šï¼Œæ›´åƒå¡é€šè²¼ç´™ */
        outline-offset: -4px;
      }

      .hero-temp-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin: 25px 0 15px 0;
      }

      .hero-icon {
        font-size: 6rem; /* æ”¾å¤§ Icon */
        filter: drop-shadow(0 4px 0 rgba(0, 0, 0, 0.1));
        animation: float 4s infinite ease-in-out; /* æ¼‚æµ®å‹•ç•« */
      }

      /* æ¼‚æµ®å‹•ç•« */
      @keyframes float {
        0% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
        100% {
          transform: translateY(0);
        }
      }

      .hero-temp {
        font-size: 6rem; /* æ”¾å¤§æº«åº¦ */
        font-weight: 900;
        color: var(--sp-brown-wood);
        line-height: 1;
        /* è®“å­—æœ‰å¯æ„›çš„æé‚Šæ„Ÿ */
        text-shadow: 2px 2px 0 var(--sp-cream-board),
          -1px -1px 0 var(--sp-cream-board);
      }

      .hero-desc {
        font-size: 1.6rem;
        color: var(--sp-dark);
        margin-bottom: 20px;
        font-weight: 900;
        letter-spacing: 2px;
      }

      /* === å»ºè­°å€ï¼šæ”¹ç‚ºå‘†å‘†ç¸ç‰Œå­ (ä¿æŒåŸæ¨£ï¼Œä½†å› æ‡‰æ–°è‰²ç³»æ›´å¥½çœ‹) === */
      .advice-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 25px;
        padding-top: 15px;
        border-top: 2px dashed var(--sp-card-border);
      }

      .advice-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        /* åƒå°æœ¨ç‰Œçš„èƒŒæ™¯ */
        background: var(--sp-pink-light);
        padding: 15px 10px;
        border-radius: 20px;
        border: 3px solid var(--sp-pink);
        box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
      }

      .advice-icon {
        font-size: 2.2rem;
        margin-bottom: 5px;
      }

      .advice-text {
        font-size: 1.5rem;
        font-weight: 900;
        color: var(--sp-dark);
        margin: 5px 0;
        line-height: 1.2;
      }

      /* === ç¨å¾Œé å ±ï¼šå¯æ„›å°å¡ === */
      .section-title {
        font-size: 1.4rem;
        color: var(--sp-brown-wood);
        margin-bottom: 15px;
        margin-left: 10px;
        font-weight: 900;
        text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.5); /* ç™½è‰²é™°å½± */
        background: var(--sp-pink-light);
        border-radius: 25px;
        padding: 8px 20px;
        border: 4px solid var(--sp-pink);
        box-shadow: 2px 4px 0 rgba(0, 0, 0, 0.15); /* åº•éƒ¨é™°å½± */
        text-align: center; /* æ–‡å­—å±…ä¸­ */
      }

      .scroll-container {
        display: flex;
        flex-wrap: wrap;
        overflow-x: auto;
        gap: 15px;
        padding-bottom: 10px;
        scroll-width: none;
        -ms-overflow-style: none;
      }

      .scroll-container::-webkit-scrollbar {
        display: none;
      }

      .mini-card {
        flex-grow: 1;
        flex-basis: 0;
        min-width: 130px;
        background: var(--sp-blue-water); /* åƒæ°´å¡˜çš„è—è‰² */
        border-radius: 25px;
        padding: 20px 15px;
        text-align: center;
        border: 6px solid white;
        flex-shrink: 0;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        transform: rotate(0.5deg); /* å¾®å¾®å‚¾æ–œï¼Œå¢æ·»ç«¥è¶£ */
      }

      .mini-time {
        background: var(--sp-pink);
        border: 4px solid #ffffff;
        color: white;
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 1.2rem;
        letter-spacing: 0.1rem;
        display: inline-block;
        margin-bottom: 10px;
        font-weight: 900;
      }

      .mini-icon {
        /* ã€ä¿®æ­£é» 2-1ã€‘é å ±å€åœ–ç¤ºé¡è‰²ï¼šç¶­æŒåŸè‰²æˆ–ç”¨æ·±è‰²ï¼Œé€™è£¡å…ˆç¶­æŒé è¨­ */
        font-size: 4rem;
        margin: 5px 0;
        color: var(--sp-dark); /* ç¢ºä¿åœ–æ¨™ç‚ºæ·±è‰² */
      }

      .mini-temp {
        font-size: 1.5rem;
        font-weight: 900;
        /* ã€ä¿®æ­£é» 2-2ã€‘é å ±å€æº«åº¦ç”¨æ·±è—è‰² */
        color: var(--sp-blue-dark);
      }

      /* ã€ä¿®æ­£é» 2-3ã€‘é å ±å€é™é›¨ç‡ç”¨æ·±è—è‰² */
      .mini-card div:last-child {
        font-size: 1rem;
        margin-top: 5px;
        font-weight: bold;
        color: var(
          --sp-blue-dark
        ) !important; /* ä½¿ç”¨ !important è¦†å¯«å…§è¯æ¨£å¼ */
      }

      /* Loading ç•«é¢ */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--sp-pink); /* å‘†å‘†ç¸çš„ç²‰ç´…è‰² */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999;
      }
    </style>
  </head>

  <body>
    <div id="loading" class="loading-screen">
      <div style="font-size: 4rem; animation: float 2.5s infinite">ğŸŒ¸</div>
      <p style="color: white; font-weight: bold; margin-top: 20px">
        å‘†å‘†ç¸æ­£åœ¨åŠªåŠ›æ€è€ƒä»Šå¤©çš„é›²æ€éº¼è·‘...
      </p>
    </div>
    <div class="status-bar">
      <div class="location-pill">ğŸ¥ è‡ºåŒ— - å‘†å‘†ç¸æ£²æ¯åœ°</div>
      <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
    </div>

    <div class="container" id="mainContent" style="display: none">
      <div id="heroCard"></div>

      <h3 class="section-title">âœ¨ å‘†å‘†ç¸çš„ä¸‹ä¸€æ­¥è¨ˆç•« (ç¨å¾Œé å ±) âœ¨</h3>
      <div class="scroll-container" id="futureForecasts"></div>
    </div>

    <script>
      const API_URL = "https://weather-cute.zeabur.app/api/weather/kaohsiung";

      // æ›¿æ› Icon æ¨£å¼ï¼Œé€™è£¡ä½¿ç”¨ Unicode æˆ– Emoji
      function getWeatherIcon(weather) {
        if (!weather) return "âœ¨";
        if (weather.includes("æ™´")) return "ğŸŒ"; // æ›æˆæ›´å¯æ„›çš„å¤ªé™½
        if (weather.includes("å¤šé›²")) return "â˜ï¸";
        if (weather.includes("é™°")) return "ğŸŒ«ï¸";
        if (weather.includes("é›¨")) return "ğŸ’§"; // ç°¡åŒ–ç‚ºæ°´æ»´
        if (weather.includes("é›·")) return "âš¡"; // é–ƒé›»
        return "â“";
      }

      // === 3. å‘†å‘†ç¸å°ˆå±¬å»ºè­°æ–‡æ¡ˆä¿®æ”¹ ===
      function getAdvice(rainProb, maxTemp) {
        let rainIcon = "ğŸŒ¸";
        let rainText = "ä»Šå¤©æ²’é›¨å‘€";
        if (parseInt(rainProb) > 30) {
          rainIcon = "â˜”";
          rainText = "è¨˜å¾—å¸¶å‘†å‘†å‚˜";
        }

        let clothIcon = "ğŸ‘’";
        let clothText = "éš¨å¿ƒæ‰€æ¬²åœ°ç©¿å§";
        if (parseInt(maxTemp) >= 28) {
          clothIcon = "ğŸ©±";
          clothText = "å»æ°´é‚Šç©ï¼å¾ˆç†±å–”"; // æ³³è¡£åœ–æ¡ˆ
        } else if (parseInt(maxTemp) <= 20) {
          clothIcon = "ğŸ§£";
          clothText = "æœ‰é»æ¶¼ï¼Œç©¿æš–ä¸€é»";
        }

        return { rainIcon, rainText, clothIcon, clothText };
      }

      function getTimePeriod(startTime) {
        const hour = new Date(startTime).getHours();
        if (hour >= 5 && hour < 11) return "æ—©é¤æ™‚é–“ï¼";
        if (hour >= 11 && hour < 14) return "åˆé¤æ™‚é–“";
        if (hour >= 14 && hour < 18) return "ä¸‹åˆèŒ¶æ™‚é–“";
        if (hour >= 18 && hour < 23) return "æ™šé¤æ™‚é–“";
        return "å®‰éœçš„å¤œæ™š";
      }

      function renderWeather(data) {
        const forecasts = data.forecasts;
        const current = forecasts[0];
        const others = forecasts.slice(1);

        // 1. æ¸²æŸ“ Hero Card (ä¸»ç•«é¢)
        const advice = getAdvice(current.rain, current.maxTemp);
        const period = getTimePeriod(current.startTime);
        const avgTemp = Math.round(
          (parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2
        );

        // ç‚ºäº†åœ¨ CSS ä¸­å¯¦ç¾åº•éƒ¨é‡˜å­ï¼Œæˆ‘å€‘åœ¨ card å…ƒç´ ä¸Šæ·»åŠ  data å±¬æ€§
        document.getElementById("heroCard").innerHTML = `
						<div class="hero-card wood-stakes" data-bottom-left="true" data-bottom-right="true">
							<div class="hero-period">${period}çš„å¤©æ°£ï¼</div>
							<div class="hero-temp-container">
								<div class="hero-icon">${getWeatherIcon(current.weather)}</div>
								<div class="hero-temp">${avgTemp}Â°</div>
							</div>
							<div class="hero-desc">ç¾åœ¨ï¼š${current.weather}</div>
							
							<div class="advice-grid">
								<div class="advice-item">
									<div class="advice-icon">${advice.rainIcon}</div>
									<div class="advice-text">${advice.rainText}</div>
									<div style="font-size:1rem; color:${
                    advice.rainIcon === "â˜”" ? "#c74949" : "#634f40"
                  }; font-weight:bold;">${
          advice.rainIcon === "â˜”" ? "æœ‰é›¨å–”" : "è¶…ä¹¾çˆ½"
        } (é™é›¨ç‡${current.rain})</div>
								</div>
								<div class="advice-item">
									<div class="advice-icon">${advice.clothIcon}</div>
									<div class="advice-text">${advice.clothText}</div>
									<div style="font-size:1rem; color:#634f40; font-weight:bold;">æ°£æº«ç¯„åœ ${
                    current.minTemp
                  }Â°~${current.maxTemp}Â°</div>
								</div>
							</div>
						</div>
					`;

        // 2. æ¸²æŸ“ç¨å¾Œé å ± (åŒ…å«æ˜å¤©åˆ¤æ–·)
        const scrollContainer = document.getElementById("futureForecasts");
        scrollContainer.innerHTML = "";

        // æŠ“ä»Šå¤©çš„æ—¥æœŸæ•¸å­— (ä¾‹å¦‚ 24)
        const todayDate = new Date().getDate();

        others.forEach((f) => {
          let p = getTimePeriod(f.startTime);

          // åˆ¤æ–·è©²é å ±çš„æ—¥æœŸæ˜¯å¦è·Ÿä»Šå¤©ä¸åŒï¼Œä¸åŒå°±æ˜¯æ˜å¤©
          const fDate = new Date(f.startTime);
          if (fDate.getDate() !== todayDate) {
            p = "æ˜å¤©çš„" + p;
          }

          // æ³¨æ„ï¼šé€™è£¡çš„é™é›¨ç‡é¡è‰²å·²ç¶“è¢« CSS ä¸­çš„ .mini-card div:last-child è¦†å¯«ç‚ºæ·±è—è‰²
          scrollContainer.innerHTML += `
							<div class="mini-card">
								<div class="mini-time">${p}</div>
								<div class="mini-icon">${getWeatherIcon(f.weather)}</div>
								<div class="mini-temp">${f.minTemp}Â° - ${f.maxTemp}Â°</div>
								<div style="font-size:1rem; color:#634f40; margin-top:5px; font-weight:bold;">ğŸ’§é™é›¨ç‡ ${
                  f.rain
                }</div>
							</div>
						`;
        });

        // 3. å³ä¸Šè§’é¡¯ç¤ºä»Šæ—¥æ—¥æœŸ
        const now = new Date();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const dayIndex = now.getDay();
        const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];

        document.getElementById(
          "updateTime"
        ).textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
      }

      async function fetchWeather() {
        try {
          // 1. å®šç¾©ã€Œæœ€ä½ç­‰å¾…æ™‚é–“ã€ï¼š1500 æ¯«ç§’ (1.5ç§’)
          const delayPromise = new Promise((resolve) =>
            setTimeout(resolve, 1500)
          );

          // 2. å®šç¾©ã€ŒæŠ“å–è³‡æ–™ã€çš„å·¥ä½œ
          const fetchPromise = fetch(API_URL).then((res) => res.json());

          // 3. Promise.all æœƒç­‰å¾…ã€Œå…©å€‹éƒ½å®Œæˆã€æ‰æœƒå¾€ä¸‹èµ°
          // result é™£åˆ—è£¡ï¼Œç¬¬ä¸€å€‹æ˜¯ delay çš„çµæœ(æ²’ç”¨åˆ°)ï¼Œç¬¬äºŒå€‹æ˜¯ api çš„ json è³‡æ–™
          const [_, json] = await Promise.all([delayPromise, fetchPromise]);

          if (json.success) {
            renderWeather(json.data);

            // è³‡æ–™è™•ç†å¥½å¾Œï¼Œéš±è— Loadingï¼Œé¡¯ç¤ºä¸»ç•«é¢
            document.getElementById("loading").style.display = "none";
            document.getElementById("mainContent").style.display = "block";
          } else {
            throw new Error("API Error");
          }
        } catch (e) {
          console.error(e);
          alert("å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼Œå‘†å‘†ç¸æŠŠç¶²è·¯ç·šç•¶æˆå°¾å·´å’¬ä½äº†ï¼");
        }
      }

      document.addEventListener("DOMContentLoaded", fetchWeather);
    </script>
  </body>
</html>
